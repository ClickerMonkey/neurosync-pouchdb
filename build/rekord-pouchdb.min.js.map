{"version":3,"sources":["rekord-pouchdb.min.js"],"names":["root","factory","define","amd","Rekord","PouchDB","module","exports","global","require","this","undefined","pouch","name","options","cache","RestFactory","database","api","Rekord_rest","call","fullSave","Cache","None","origin","uuid","storeOptions","include_docs","replicate","live","retry","debug","Debugs","POUCH_INIT","pouchdb","all","success","failure","onAll","response","POUCH_ALL","values","i","rows","length","push","doc","onAllError","err","POUCH_ALL_ERROR","status","allDocs","then","get","model","onGet","POUCH_GET","key","_rev","onGetError","POUCH_GET_ERROR","String","$key","create","encoded","onCreate","POUCH_CREATE","ok","rev","onCreateError","POUCH_CREATE_ERROR","_id","$origin","put","update","onUpdate","POUCH_UPDATE","onUpdateError","POUCH_UPDATE_ERROR","remove","onRemove","POUCH_REMOVE","onRemoveError","POUCH_REMOVE_ERROR","query","url","LiveFactory","onLiveChange","change","deleted","POUCH_LIVE_REMOVE","liveRemove","id","POUCH_LIVE_SAVE","liveSave","POUCH_LIVE_SAVE_IGNORE","Rekord_live","since","changes","on","save","noop","rest","store","debugMap","setRest","setLive"],"mappings":"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","file":"rekord-pouchdb.min.js","sourcesContent":["/* rekord-pouchdb 1.4.2 - A rekord binding to pouchdb - implementing Rekord.rest, Rekord.live, & Rekord.store by Philip Diffenderfer */\n// UMD (Universal Module Definition)\n(function (root, factory)\n{\n  if (typeof define === 'function' && define.amd) // jshint ignore:line\n  {\n    // AMD. Register as an anonymous module.\n    define(['Rekord', 'PouchDB'], function(Rekord, PouchDB) { // jshint ignore:line\n      return factory(root, Rekord, PouchDB);\n    });\n  }\n  else if (typeof module === 'object' && module.exports)  // jshint ignore:line\n  {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = factory(global, require('Rekord'), require('PouchDB'));  // jshint ignore:line\n  }\n  else\n  {\n    // Browser globals (root is window)\n    root.Rekord = factory(root, root.Rekord, root.PouchDB);\n  }\n}(this, function(global, Rekord, PouchDB, undefined)\n{\n\n  var Debugs = Rekord.Debugs;\n\n  var cache = {};\n\n  var Rekord_live = Rekord.live;\n  var Rekord_rest = Rekord.rest;\n  var Rekord_store = Rekord.store;\n\n  Debugs.POUCH_INIT = 2000;\n  Debugs.POUCH_ALL = 2001;\n  Debugs.POUCH_ALL_ERROR = 2002;\n  Debugs.POUCH_GET = 2003;\n  Debugs.POUCH_GET_ERROR = 2004;\n  Debugs.POUCH_CREATE = 2005;\n  Debugs.POUCH_CREATE_ERROR = 2006;\n  Debugs.POUCH_UPDATE = 2007;\n  Debugs.POUCH_UPDATE_ERROR = 2008;\n  Debugs.POUCH_REMOVE = 2009;\n  Debugs.POUCH_REMOVE_ERROR = 2010;\n  Debugs.POUCH_LIVE_REMOVE = 2011;\n  Debugs.POUCH_LIVE_SAVE = 2012;\n  Debugs.POUCH_LIVE_SAVE_IGNORE = 2013;\n\n  if ( Rekord.debugMap )\n  {\n    Rekord.debugMap[ Debugs.POUCH_INIT ] = 'PouchDB Initialized';\n    Rekord.debugMap[ Debugs.POUCH_ALL ] = 'PouchDB All';\n    Rekord.debugMap[ Debugs.POUCH_ALL_ERROR ] = 'PouchDB All Error';\n    Rekord.debugMap[ Debugs.POUCH_GET ] = 'PouchDB Get';\n    Rekord.debugMap[ Debugs.POUCH_GET_ERROR ] = 'PouchDB Get Error';\n    Rekord.debugMap[ Debugs.POUCH_CREATE ] = 'PouchDB Create';\n    Rekord.debugMap[ Debugs.POUCH_CREATE_ERROR ] = 'PouchDB Create Error';\n    Rekord.debugMap[ Debugs.POUCH_UPDATE ] = 'PouchDB Update';\n    Rekord.debugMap[ Debugs.POUCH_UPDATE_ERROR ] = 'PouchDB Update Error';\n    Rekord.debugMap[ Debugs.POUCH_REMOVE ] = 'PouchDB Remove';\n    Rekord.debugMap[ Debugs.POUCH_REMOVE_ERROR ] = 'PouchDB Remove Error';\n    Rekord.debugMap[ Debugs.POUCH_LIVE_REMOVE ] = 'PouchDB Live Remove';\n    Rekord.debugMap[ Debugs.POUCH_LIVE_SAVE ] = 'PouchDB Live Save';\n    Rekord.debugMap[ Debugs.POUCH_LIVE_SAVE_IGNORE ] = 'PouchDB Live Save Ignored';\n  }\n\n  function pouch(name, options)\n  {\n    return name in cache ? cache[ name ] : cache[ name ] = new PouchDB( name, options );\n  }\n\n  function RestFactory(database)\n  {\n    if ( !database.api )\n    {\n      return Rekord_rest.call( this, database );\n    }\n\n    database.fullSave = true;\n    database.cache = Rekord.Cache.None;\n    database.origin = Rekord.uuid();\n\n    var pouch = this.pouch( database.name, database.storeOptions );\n\n    var options = {\n      include_docs: true\n    };\n\n    PouchDB.replicate( database.name, database.api, {\n      live: true,\n      retry: true\n    });\n\n    Rekord.debug( Debugs.POUCH_INIT, database, pouch );\n\n    return {\n\n      pouchdb: pouch,\n\n      all: function( success, failure )\n      {\n        function onAll(response)\n        {\n          Rekord.debug( Debugs.POUCH_ALL, database, response );\n\n          var values = [];\n          for (var i = 0; i < response.rows.length; i++)\n          {\n            values.push( response.rows[ i ].doc );\n          }\n\n          success( values );\n        }\n\n        function onAllError(err)\n        {\n          Rekord.debug( Debugs.POUCH_ALL_ERROR, database, err );\n\n          failure( [], err.status );\n        }\n\n        pouch.allDocs( options ).then( onAll ).catch( onAllError );\n      },\n\n      get: function( model, success, failure )\n      {\n        var key = String( model.$key() );\n\n        function onGet(response)\n        {\n          Rekord.debug( Debugs.POUCH_GET, database, model, key, response );\n\n          model._rev = response._rev;\n          success( response );\n        }\n\n        function onGetError(err)\n        {\n          Rekord.debug( Debugs.POUCH_GET_ERROR, database, model, key, err );\n\n          failure( null, err.status );\n        }\n\n        pouch.get( key ).then( onGet ).catch( onGetError );\n      },\n\n      create: function( model, encoded, success, failure )\n      {\n        encoded._id = String( model.$key() );\n        encoded.$origin = database.origin;\n\n        function onCreate(response)\n        {\n          Rekord.debug( Debugs.POUCH_CREATE, database, model, encoded, response );\n\n          if ( response.ok )\n          {\n            model._rev = response.rev;\n            encoded._rev = response.rev;\n            success( {} );\n          }\n          else\n          {\n            failure( null, response.status );\n          }\n        }\n\n        function onCreateError(err)\n        {\n          Rekord.debug( Debugs.POUCH_CREATE_ERROR, database, model, encoded, err );\n\n          failure( null, err.status );\n        }\n\n        pouch.put( encoded ).then( onCreate ).catch( onCreateError );\n      },\n\n      update: function( model, encoded, success, failure )\n      {\n        encoded._id = String( model.$key() );\n        encoded._rev = model._rev;\n        encoded.$origin = database.origin;\n\n        function onUpdate(response)\n        {\n          Rekord.debug( Debugs.POUCH_UPDATE, database, model, encoded, response );\n\n          if ( response.ok )\n          {\n            model._rev = response.rev;\n            encoded._rev = response.rev;\n            success( {} );\n          }\n          else\n          {\n            failure( null, response.status );\n          }\n        }\n\n        function onUpdateError(err)\n        {\n          Rekord.debug( Debugs.POUCH_UPDATE_ERROR, database, model, encoded, err );\n\n          failure( null, err.status );\n        }\n\n        pouch.put( encoded ).then( onUpdate ).catch( onUpdateError );\n      },\n\n      remove: function( model, success, failure )\n      {\n        var key = String( model.$key() );\n\n        function onRemove(response)\n        {\n          Rekord.debug( Debugs.POUCH_REMOVE, database, model, key, response );\n\n          if ( response.ok )\n          {\n            success( {} );\n          }\n          else\n          {\n            failure( {}, response.status );\n          }\n        }\n\n        function onRemoveError(err)\n        {\n          Rekord.debug( Debugs.POUCH_REMOVE_ERROR, database, model, key, err );\n\n          failure( {}, err.status );\n        }\n\n        pouch.remove( key ).then( onRemove ).catch( onRemoveError );\n      },\n\n      query: function( url, query, success, failure )\n      {\n        success( [] );\n      }\n\n    };\n  }\n\n  function LiveFactory(database)\n  {\n    if ( !database.api )\n    {\n      return Rekord_live.call( this, database );\n    }\n\n    var pouch = this.pouch( database.name );\n    var options =\n    {\n      since: 'now',\n      live: true,\n      include_docs: true\n    };\n\n    function onLiveChange(change)\n    {\n      if ( change.deleted )\n      {\n        Rekord.debug( Debugs.POUCH_LIVE_REMOVE, database, change );\n\n        database.liveRemove( change.id );\n      }\n      else\n      {\n        if ( change.doc.$origin !== database.origin )\n        {\n          Rekord.debug( Debugs.POUCH_LIVE_SAVE, database, change );\n\n          database.liveSave( change.id, change.doc );\n        }\n        else\n        {\n          Rekord.debug( Debugs.POUCH_LIVE_SAVE_IGNORE, database, change );\n        }\n      }\n    }\n\n    pouch.changes( options ).on( 'change', onLiveChange );\n\n    return {\n      pouchdb: pouch,\n      save: Rekord.noop,\n      remove: Rekord.noop\n    };\n  }\n\n  Rekord.pouch = pouch;\n  Rekord.setRest( RestFactory );\n  Rekord.setLive( LiveFactory );\n\n  return Rekord;\n\n}));\n"],"sourceRoot":"/source/"}